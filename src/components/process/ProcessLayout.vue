<script setup lang="ts">
import { inject } from 'vue';
import ProcessHeaderTab from './components/children/ProcessHeaderTab.vue';
import ProcessLog from './components/children/ProcessLog.vue';
import ProcessLogTab from './components/children/ProcessLogTab.vue';
import ProcessStatus from './components/children/ProcessStatus.vue';
import ProcessTotalStatus from './components/children/ProcessTotalStatus.vue';
import ProcessHeaderLayout from './components/ProcessHeaderLayout.vue';
import ProcessLogLayout from './components/ProcessLogLayout.vue';
import ProcessStatusLayout from './components/ProcessStatusLayout.vue';
import ProcessDataProvider from './provider/ProcessDataProvider.vue';
import OverviewSocket from './socket/OverviewSocket.vue';
import ProcessSocket from './socket/ProcessSocket.vue';
import { LeftArea } from '../layout/provider/LayoutDataProvider.vue';
import ProcessTotalLog from './components/children/ProcessTotalLog.vue';
import ProcessStatusTimeLine from './components/children/ProcessStatusTimeLine.vue';

const props = inject<LeftArea>('leftArea')
</script>
<template>
    <div id="processLayout">
        <ProcessDataProvider :props="props">
            <template #Socket="{ props: { onResponse } }">
                <OverviewSocket @response="onResponse"/>
             </template>
    
            <template #Header>
                <ProcessHeaderLayout>
                    <template #TopLeft>
                        Jenkins Multibranch PipeLine Stage ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
                    </template>
                    <template #TopCenter>
                    </template>
                    <template #TopRight>
                    </template>
    
                    <template #SubTitle>
                        <div class="flex gap-[15px] hj-branch-step">
                            <div>
                                ë¸Œëœì¹˜ ì „ëµ :
                            </div>
                            <div>
                                feature(ê¸°ëŠ¥ ê°œë°œ: ë¹Œë“œ í…ŒìŠ¤íŠ¸)
                            </div>
                            <div>></div>
                            <div>
                                dev(ë°°í¬ ë° mainì— ë¹Œë“œ í…ŒìŠ¤íŠ¸)
                            </div>
                            <div>></div>
                            <div>
                                main(ë°°í¬)   
                            </div>
                        </div>
                    </template>
    
                    <template #Header>
                        <div class="flex flex-col gap-[3px]">
                            <div style="font-weight: bold;">
                                í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
                            </div>
                            <div class="pl-[20px] flex hj-scenario-list">
                                1. ê°œë°œì ê¸°ëŠ¥ê°œë°œ ì™„ë£Œ í›„ git repoì— push
                            </div>
                            <div class="pl-[20px] hj-scenario-list">
                                2. ìë™í™” ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ ì§„í–‰
                            </div>
                            <div class="pl-[20px] hj-scenario-list">
                                3. ê´€ë¦¬ìëŠ” Slack ë¹Œë“œ ì„±ê³µ ì•Œë¦¼ í™•ì¸
                            </div>
                            <div class="pl-[20px] hj-scenario-list">
                                4. ê´€ë¦¬ìëŠ” devë¸Œëœì¹˜ì— merge
                            </div>
                            <div class="pl-[20px] hj-scenario-list">
                                5. QAíŒ€ í™•ì¸ > ê´€ë¦¬ìì—ê²Œ ê²°ê³¼ ì „ë‹¬
                            </div>
                            <div class="pl-[20px] hj-scenario-list">
                                6. ê´€ë¦¬ì ê²°ê³¼ í™•ì¸ í›„ mainë¸Œëœì¹˜ì— merge
                            </div>
                        </div>
                    </template>
                    <template #Content>
                        <div class="flex flex-col gap-[3px] pl-[15px]">
                            <div style="font-weight: bold;">
                                ê°œë°œ í™˜ê²½ ë° ì‚¬ìš© ê¸°ìˆ 
                            </div>
                            <div class="hj-stack-list">
                                <div class="hj-stack-title">
                                    OS : 
                                </div>
                                <div class="hj-stack-item">MacOS</div>
                            </div>
                            <div class="hj-stack-list">
                                <div class="hj-stack-title">
                                    Frontend : 
                                </div>
                                <div class="hj-stack-item">Vue3</div>
                                <div class="hj-stack-item">WebSocket</div>
                                <div class="hj-stack-item">Axios</div>
                                <div class="hj-stack-item">Nginx</div>
                                <div class="hj-stack-item">Typescript</div>
                            </div>
                            <div class="hj-stack-list">
                                <div class="hj-stack-title">
                                    Backend : 
                                </div>
                                <div class="hj-stack-item">SpringBoot</div>
                                <div class="hj-stack-item">Spring WebSocket</div>
                            </div>
                            <div class="hj-stack-list">
                                <div class="hj-stack-title">
                                    API : 
                                </div>
                                <div class="hj-stack-item">Github API</div>
                                <div class="hj-stack-item">Jenkins Workflow API</div>
                            </div>
                            <div class="hj-stack-list">
                                <div class="hj-stack-title">
                                    DevOps : 
                                </div>
                                <div class="hj-stack-item">Jenkins</div>
                                <div class="hj-stack-item">Docker</div>
                                <div class="hj-stack-item">Slack</div>
                                <div class="hj-stack-item">Git</div>
                                <div class="hj-stack-item">Github Webhook</div>
                                <div class="hj-stack-item">Slack Incomming Webhook</div>
                            </div>
                            <div class="hj-stack-list">
                                <div class="hj-stack-title">
                                    Version : 
                                </div>
                                <div class="hj-stack-item">node:20.19.5</div>
                                <div class="hj-stack-item">nginx:1.29.1</div>
                                <div class="hj-stack-item">Java17</div>
                            </div>
                        </div>
                    </template>
                    <template #Reference>
                        <div class="flex flex-col p-[15px] gap-[5px]">
                            <div style="font-weight: bold;">
                                Reference
                            </div>
                            <div>
                                <a class="hj-link" href="https://github.com/ANDUYONG/HelloJenkins" target="_blank">
                                    ğŸš© (Frontend) Git Repository
                                </a>
                            </div>
                            <div>
                                <a class="hj-link" href="https://github.com/ANDUYONG/HelloJenkinsBackend" target="_blank">
                                    ğŸš© (Backend) Git Repository
                                </a>
                            </div>
                        </div>
                    </template>

                    <template #Footer>
                        <div class="flex flex-col">
                            <div style="font-weight: bold; font-size: 0.9em;">
                                â€» ì°¸ê³ ì‚¬í•­
                            </div>
                            <div style="color: red; font-size: 0.8em;">
                                ##Slack Channelì—ì„œ ì•ŒëŒì„ ë°›ì•„ë³´ê³  ì‹¶ë‹¤ë©´
                                du2sam@naver.com ë¡œ ì „ë‹¬ë°›ì„ emailì„ ë‚¨ê²¨ì£¼ì„¸ìš”.##
                            </div>
                            <div class="hj-bottom-explain">
                                **Total: ê° ë¸Œëœì¹˜ ë³„ ì§„í–‰ìƒíƒœ í™•ì¸ ë° ì „ì²´ ë¡œê·¸ í™•ì¸**
                            </div>
                            <div class="hj-bottom-explain">
                                **ê° íƒ­: StageOverview ë° íƒ€ì„ë¼ì¸**
                            </div>
                        </div>
                    </template>
                </ProcessHeaderLayout>
            </template>
    
            <template #Status="{ props: {
                processItems, tabs, onHeaderTabChange, currentTab, 
                currentType, currentTypeItems, stages, isTotalProcess
            }}">
                <ProcessStatusLayout :isTotal="isTotalProcess">
                    <template #BranchTab>
                        <ProcessHeaderTab
                            :value="currentTab"
                            :items="tabs"
                            :processItems="processItems"
                            @change="onHeaderTabChange"
                        />
                    </template>
                    <template #Header>
                        <ProcessTotalStatus
                            :value="currentType"
                            :items="currentTypeItems"
                        />
                        </template>
                        <template #Content>
                            <ProcessStatusTimeLine :isTotalProcess="isTotalProcess" :items="stages" :processItems="processItems"/>
                        </template>
                </ProcessStatusLayout>
            </template>
    
            <template #Log="{ props: { processItems, tree, isTotalProcess, currentLogItem, currentLogTab, currentStage, totalLog, onLogTabChange } }">
                <ProcessLogLayout>
                    <template #Tab>
                        <ProcessLogTab
                            :value="currentLogTab"
                            :items="tree.data.stages"
                            :processItems="processItems"
                            :isTotalProcess="isTotalProcess"
                            @change="onLogTabChange"
                        />
                    </template>
                    <template #Log>
                        <ProcessTotalLog v-if="isTotalProcess" :value="totalLog" :title="currentStage"/>
                        <ProcessLog v-else :item="currentLogItem" :title="currentStage"/>
                    </template>
                </ProcessLogLayout>
            </template>
        </ProcessDataProvider>
    </div>
</template>
<style scoped>
/* ProcessDataProviderì˜ ë†’ì´ë¥¼ 100%ë¡œ ì„¤ì •í•˜ì—¬ ë¶€ëª¨ë¥¼ ì±„ìš°ê³  ë‚´ë¶€ì—ì„œ flex-colë¡œ ë°°ì¹˜ë˜ê²Œ í•©ë‹ˆë‹¤. */
#processLayout { /* ProcessDataProvider */
    flex-grow: 1;
    min-height: 0;
    min-width: 100%;
}

.hj-branch-step {
    color: orange;
}

.hj-scenario-list {
    height: 20px;
    font-size: 0.9em;
    border: 1px solid #6c90d3;
    background-color: #6c90d3;
    color: white;
    border-radius: 8px;
}

.hj-bottom-explain {
    font-size: 0.9em;
    text-decoration: underline;
}

.hj-stack-list {
    display: flex;
    flex-direction: row;
    font-size: 0.8em;
    flex-wrap: wrap;
}

.hj-stack-title {
    display: inline-flex; /* í…ìŠ¤íŠ¸ ë‚´ìš©ì— ë§ê²Œ ë„ˆë¹„ ì¡°ì ˆ ë° ë‚´ë¶€ ì •ë ¬ */
    align-items: center;  /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
    justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
    padding: 4px 10px; /* ìƒí•˜ì¢Œìš° ë‚´ë¶€ ì—¬ë°± */
}

.hj-stack-item {
    display: inline-flex; /* í…ìŠ¤íŠ¸ ë‚´ìš©ì— ë§ê²Œ ë„ˆë¹„ ì¡°ì ˆ ë° ë‚´ë¶€ ì •ë ¬ */
    align-items: center;  /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
    justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
    
    padding: 4px 8px; /* ìƒí•˜ì¢Œìš° ë‚´ë¶€ ì—¬ë°± */
    
    background-color: #8393b1; /* ë±ƒì§€ ë°°ê²½ìƒ‰ (ì˜ˆì‹œ: íŒŒë€ìƒ‰) */
    color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
    
    border-radius: 12px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ (ê°’ì´ í´ìˆ˜ë¡ ìº¡ìŠ ëª¨ì–‘) */
    font-size: 0.8em; /* ê¸€ì í¬ê¸° */
    font-weight: bold; /* ê¸€ì ë‘ê»˜ */
    
    /* ì„ íƒ ì‚¬í•­: ë±ƒì§€ë“¤ ê°„ì˜ ê°„ê²© */
    margin: 2px; 
    
    /* ì„ íƒ ì‚¬í•­: í…ìŠ¤íŠ¸ ì¥ì‹ ì œê±° (ë§í¬ ë“±ìœ¼ë¡œ ì‚¬ìš©ë  ê²½ìš°) */
    text-decoration: none; 
}

.hj-link {
    text-decoration: underline;
}
</style>